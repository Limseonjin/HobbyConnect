<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.mvc.member.repository.MainBoardMapper">



   <!--  게시글 만들기 테이블
   CREATE TABLE tbl_main_board
(
    main_board_id      INTEGER AUTO_INCREMENT,
    person_id     VARCHAR(16),
    main_board_title   VARCHAR(20) NOT NULL,
    main_board_content VARCHAR(400),
    room_id       INTEGER,
    view_count INTEGER,
    reg_date TIME DEFAULT current_timestamp,
    CONSTRAINT pk_main_board PRIMARY KEY (main_board_id),
    CONSTRAINT fk_main_board_person
        FOREIGN KEY (person_id)
            REFERENCES tbl_person (person_id),
    CONSTRAINT fk_main_board_room
        FOREIGN KEY (room_id)
            REFERENCES tbl_room (room_id)
);

-->



    <!-- 게시글을 만든다-->
    <insert id="save" useGeneratedKeys="true" keyProperty="mainBoardId">
        INSERT INTO tbl_main_board
        (person_id,main_board_title, main_board_content)
        VALUES
        (#{personId},#{mainBoardTitle},#{mainBoardContent})
    </insert>

    <!-- 모든 게시글을 조회한다.-->
    <select id="findAll" resultType="MainBoard">
    SELECT *
        FROM tbl_main_board mb
        JOIN tbl_room r ON mb.main_board_id = r.room_id
    </select>

    <!-- 모든 게시글을 조회시 페이징 처리한다.-->
    <select id="pagefindAll" resultType="MainBoard">
        SELECT *
        FROM tbl_main_board mb
        JOIN tbl_room r ON mb.main_board_id = r.room_id
        ORDER BY main_board_id DESC
        LIMIT #{p.pageStart},#{p.amount}
    </select>

    <!-- 특정 사용자가 만든 게시글을 조회한다.-->
    <select id="findPersonId" resultType="MainBoard">
        SELECT * FROM tbl_main_board mb
        JOIN tbl_room r ON mb.room_id = r.room_id
        WHERE mb.person_id = #{personId}
        ORDER BY main_board_id DESC
        LIMIT #{p.pageStart},#{p.amount}
    </select>

    <!-- 내가 찾고 싶은 게시글 제목으로 조회-->
    <select id="findTitle" resultType="MainBoard">
        SELECT * FROM  tbl_main_board mb
        JOIN tbl_room r ON mb.room_id = r.room_id
        WHERE main_board_title LIKE CONCAT('%',#{keyword},'%')
        ORDER BY main_board_id DESC
        LIMIT #{p.pageStart},#{p.amount}
    </select>

    <update id="modify">
        UPDATE tbl_main_board
        SET main_board_title = #{mainBoardTitle},
        main_board_content = #{mainBoardContent}
        WHERE main_board_id = #{mainBoardId}
    </update>

    <update id="roomSave">
        UPDATE tbl_main_board
        SET room_id = #{mainBoardId}
        WHERE main_board_id = #{mainBoardId}
    </update>


    <!-- 내 게시글 삭제하기-->
    <delete id="delete">
        delete FROM tbl_main_board WHERE main_board_id = #{mainBoardId}
    </delete>


</mapper>